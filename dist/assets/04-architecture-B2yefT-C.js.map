{"version":3,"file":"04-architecture-B2yefT-C.js","sources":["../../pages/04-architecture.md"],"sourcesContent":["# 04 – Architecture\r\n\r\n## Directory Structure (Key Parts)\r\n\r\n```\r\napp/\r\n├── Actions/           # CreateAudioTranslationAction\r\n├── Constants/         # AudioConstants (TTS chunk size, etc.)\r\n├── Http/\r\n│   ├── Controllers/   # AudioController, TextToAudioController, PaymentController, Admin, etc.\r\n│   ├── Middleware/    # Admin, AudioLimits, WebhookThrottle\r\n│   └── Requests/      # StoreAudioRequest\r\n├── Jobs/              # ProcessAudioJob, ProcessTextToAudioJob, ProcessCsvTranslationJob, etc.\r\n├── Models/            # User, AudioFile, TextToAudio, Payment, etc.\r\n├── Services/          # Core business logic\r\n│   ├── AudioProcessingService.php   # Orchestrates transcription, translation, TTS\r\n│   ├── GeminiTtsService.php         # Gemini TTS with chunking\r\n│   ├── GoogleOAuthService.php       # Service account auth, token cache\r\n│   ├── GoogleTranslationService.php # Translation API v3\r\n│   ├── LanguageDetectionService.php # Detect language\r\n│   ├── SimpleTtsService.php         # OpenAI TTS fallback (optional)\r\n│   ├── CsvParserService.php         # CSV parsing\r\n│   ├── ExcelParserService.php       # XLSX parsing\r\n│   ├── MultiSheetService.php        # Multi-sheet XLSX\r\n│   ├── CreditService.php            # Credit deduction\r\n│   ├── FFmpegService.php            # Audio extraction (optional)\r\n│   ├── RateLimiter.php              # TTS rate limiting\r\n│   └── SanitizationService.php      # Cleanup\r\n└── Traits/            # HasAudioFiles\r\n\r\nconfig/\r\n├── audio.php          # Languages, voices, limits\r\n├── gemini.php         # TTS config\r\n├── services.php       # Google Cloud\r\n├── stripe.php         # Payments\r\n└── openai.php         # OpenAI\r\n\r\nroutes/\r\n└── web.php            # All routes\r\n```\r\n\r\n## Routes\r\n\r\n| Route | Method | Purpose |\r\n|-------|--------|---------|\r\n| `/` | GET | Welcome |\r\n| `/login`, `/register`, `/logout` | GET/POST | Auth |\r\n| `/admin/login`, `/admin/logout` | GET/POST | Admin auth |\r\n| `/webhook/stripe` | POST | Stripe webhook (no auth) |\r\n| `/audio` | GET/POST | Create, index, show |\r\n| `/audio/{id}/status` | GET | Poll processing status |\r\n| `/audio/{id}/download` | GET | Download translated audio |\r\n| `/audio/{id}/approve-transcription`, `/approve-tts` | POST | Approval steps |\r\n| `/text-to-audio` | GET/POST | Create, index, show |\r\n| `/text-to-audio/{id}/status` | GET | Poll status |\r\n| `/credits` | GET | Credits page |\r\n| `/checkout` | POST | Stripe checkout |\r\n| `/admin/dashboard` | GET | Admin dashboard |\r\n| `/admin/csv-translations` | GET/POST | CSV translation upload, status, download |\r\n\r\n## Service Flow (Audio Translation)\r\n\r\n1. User uploads audio → `AudioController::store` → `CreateAudioTranslationAction`\r\n2. `ProcessAudioJob` dispatched\r\n3. Job: `AudioProcessingService::transcribeAudio` (Whisper)\r\n4. Job: `AudioProcessingService::translateText` (Google Translation) – or use `GoogleTranslationService` for batch\r\n5. Job: `AudioProcessingService::generateAudio` (Gemini TTS)\r\n6. User polls `/audio/{id}/status` for progress\r\n7. User downloads result\r\n\r\n## Service Flow (Text-to-Audio)\r\n\r\n1. User submits text → `TextToAudioController::store`\r\n2. `ProcessTextToAudioJob` dispatched\r\n3. Job: `AudioProcessingService::generateAudio` (Gemini TTS)\r\n4. User polls `/text-to-audio/{id}/status`\r\n5. User downloads result\r\n"],"names":["_jsx","_components"],"mappings":"suBAAE,SAAA;iDAEC,SAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAuCA,SAAA;uFAED,SAAA,sBAAQ,SAAA,uBAAS,SAAA,mHAEjB,SAAA,oBAAM,SAAA,oBAAM,SAAA,yFACZ,SAAA,QAAQ,CAAA,EAAA,KAAAA,MAAAC,EAAA,KAAA,eAAE,SAAA,WAAW,CAAA,EAAA,KAAAD,MAAAC,EAAA,KAAA,eAAE,SAAA,2BAAY,SAAA,yBAAW,SAAA,sFAC9C,SAAA,cAAc,CAAA,EAAA,KAAAD,MAAAC,EAAA,KAAA,eAAE,SAAA,iCAAkB,SAAA,yBAAW,SAAA,0FAC7C,SAAA,kCAAoB,SAAA,qBAAO,SAAA,wGAC3B,SAAA,yBAAW,SAAA,yBAAW,SAAA,mGACtB,SAAA,qCAAuB,SAAA,oBAAM,SAAA,sGAC7B,SAAA,uCAAyB,SAAA,oBAAM,SAAA,2GAC/B,SAAA,mCAAmC,CAAA,EAAA,KAAAD,MAAAC,EAAA,KAAA,eAAE,SAAA,gCAAiB,SAAA,qBAAO,SAAA,8FAC7D,SAAA,iCAAmB,SAAA,yBAAW,SAAA,mGAC9B,SAAA,6CAA+B,SAAA,oBAAM,SAAA,2FACrC,SAAA,2BAAa,SAAA,oBAAM,SAAA,4FACnB,SAAA,4BAAc,SAAA,qBAAO,SAAA,+FACrB,SAAA,mCAAqB,SAAA,oBAAM,SAAA,+FAC3B,SAAA,0CAA4B,SAAA,yBAAW,SAAA;kDAEtC,SAAA;;eAEA,SAAA,CAAA,wBAAAD,MAAAC,EAAA,KAAA,eAAqB,SAAA,wBAAwB,CAAA,EAAA,MAAAD,MAAAC,EAAA,KAAA,eAAG,SAAA;qDAChD,SAAA,iBAAiB,CAAA,EAAA,aAAA;eACjB,SAAA,CAAA,QAAAD,MAAAC,EAAA,KAAA,eAAK,SAAA,yCAAyC,CAAA,EAAA,YAAA;eAC9C,SAAA,CAAA,QAAAD,MAAAC,EAAA,KAAA,eAAK,SAAA,uCAAuC,CAAA,EAAA,kCAAAD,MAAAC,EAAA,KAAA,eAA+B,SAAA,0BAA0B,CAAA,EAAA,YAAA;eACrG,SAAA,CAAA,QAAAD,MAAAC,EAAA,KAAA,eAAK,SAAA,uCAAuC,CAAA,EAAA,eAAA;eAC5C,SAAA,CAAA,cAAAD,MAAAC,EAAA,KAAA,eAAW,SAAA,oBAAoB,CAAA,EAAA,eAAA;cAC/B,SAAA;;8CAEA,SAAA;;eAEA,SAAA,CAAA,uBAAAD,MAAAC,EAAA,KAAA,eAAoB,SAAA;qDACpB,SAAA,uBAAuB,CAAA,EAAA,aAAA;eACvB,SAAA,CAAA,QAAAD,MAAAC,EAAA,KAAA,eAAK,SAAA,uCAAuC,CAAA,EAAA,eAAA;eAC5C,SAAA,CAAA,cAAAD,MAAAC,EAAA,KAAA,eAAW,SAAA;cACX,SAAA;"}